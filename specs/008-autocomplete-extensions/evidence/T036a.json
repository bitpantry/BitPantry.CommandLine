{
  "taskId": "T036a",
  "testCase": "",
  "red": {
    "timestamp": "2026-01-21T17:08:11.8440763-06:00",
    "testCommand": "dotnet test --filter HandlerException_GracefullyDegrades_ReturnsNoSuggestions",
    "exitCode": 1,
    "output": "System.InvalidOperationException: Test exception from ThrowingHandler",
    "testFile": "BitPantry.CommandLine.Tests/AutoCompleteControllerTests.cs",
    "testMethod": "HandlerException_GracefullyDegrades_ReturnsNoSuggestions"
  },
  "green": {
    "timestamp": "2026-01-21T17:09:44.2908651-06:00",
    "testCommand": "dotnet test --filter HandlerException_GracefullyDegrades_ReturnsNoSuggestions",
    "exitCode": 0,
    "output": "Passed: 1, Failed: 0"
  },
  "diff": {
    "timestamp": "2026-01-21T17:09:44.2908651-06:00",
    "files": [
      "BitPantry.CommandLine.Tests/AutoCompleteControllerTests.cs",
      "BitPantry.CommandLine/AutoComplete/AutoCompleteOptionSetBuilder.cs",
      "specs/008-autocomplete-extensions/batch-state.json",
      "specs/008-autocomplete-extensions/evidence/T036a.json"
    ],
    "patch": "diff --git a/BitPantry.CommandLine.Tests/AutoCompleteControllerTests.cs b/BitPantry.CommandLine.Tests/AutoCompleteControllerTests.cs\nindex cd464ec..76d9699 100644\n--- a/BitPantry.CommandLine.Tests/AutoCompleteControllerTests.cs\n+++ b/BitPantry.CommandLine.Tests/AutoCompleteControllerTests.cs\n@@ -479,6 +479,43 @@ namespace BitPantry.CommandLine.Tests\n             input.Buffer.Should().Be(\"CommandWithNullableEnumArg --Level Error\");\n         }\n \n+        /// <summary>\n+        /// Implements: 008:TC-4.7\n+        /// Handler exception gracefully degrades with logging.\n+        /// When handler throws an exception, autocomplete returns no suggestions (graceful degradation).\n+        /// </summary>\n+        [TestMethod]\n+        public async Task HandlerException_GracefullyDegrades_ReturnsNoSuggestions()\n+        {\n+            // Arrange - set up registry with command that has throwing handler\n+            var services = new ServiceCollection();\n+            services.AddTransient<ThrowingHandler>(); // Register the throwing handler with DI\n+            var builder = new CommandRegistryBuilder();\n+            builder.RegisterCommand<CommandWithThrowingHandler>(); // CommandWithThrowingHandler --Value\n+            var registry = builder.Build(services);\n+\n+            var handlerBuilder = new AutoCompleteHandlerRegistryBuilder();\n+            var handlerRegistry = handlerBuilder.Build(services);\n+\n+            var sp = services.BuildServiceProvider();\n+\n+            var console = new VirtualConsoleAnsiAdapter(new BitPantry.VirtualConsole.VirtualConsole(80, 24));\n+            var input = new ConsoleLineMirror(console);\n+            var acCtrl = new AutoCompleteController(\n+                new AutoCompleteOptionSetBuilder(registry, new NoopServerProxy(), sp, handlerRegistry));\n+\n+            // User types command and triggers autocomplete on the argument with throwing handler\n+            input.Write(\"CommandWithThrowingHandler --Value \");\n+\n+            // Act - trigger autocomplete (handler will throw)\n+            // This should NOT throw - exception should be caught and handled gracefully\n+            await acCtrl.Begin(input);\n+\n+            // Assert - buffer should remain unchanged (no autocomplete suggestions applied)\n+            // The handler threw an exception, so no options should be available\n+            input.Buffer.Should().Be(\"CommandWithThrowingHandler --Value \");\n+        }\n+\n         #endregion\n \n         #region Test Helpers\n@@ -601,6 +638,32 @@ namespace BitPantry.CommandLine.Tests\n             public void Execute(CommandExecutionContext ctx) { }\n         }\n \n+        /// <summary>\n+        /// Handler that throws an exception for testing graceful degradation.\n+        /// </summary>\n+        private class ThrowingHandler : IAutoCompleteHandler\n+        {\n+            public Task<List<AutoCompleteOption>> GetOptionsAsync(\n+                AutoCompleteContext context,\n+                CancellationToken cancellationToken = default)\n+            {\n+                throw new InvalidOperationException(\"Test exception from ThrowingHandler\");\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Command with a throwing handler for testing exception handling.\n+        /// </summary>\n+        [Command]\n+        private class CommandWithThrowingHandler : CommandBase\n+        {\n+            [Argument]\n+            [AutoComplete<ThrowingHandler>]\n+            public string Value { get; set; }\n+\n+            public void Execute(CommandExecutionContext ctx) { }\n+        }\n+\n         #endregion\n     }\n }\ndiff --git a/BitPantry.CommandLine/AutoComplete/AutoCompleteOptionSetBuilder.cs b/BitPantry.CommandLine/AutoComplete/AutoCompleteOptionSetBuilder.cs\nindex d0f633e..15f5c95 100644\n--- a/BitPantry.CommandLine/AutoComplete/AutoCompleteOptionSetBuilder.cs\n+++ b/BitPantry.CommandLine/AutoComplete/AutoCompleteOptionSetBuilder.cs\n@@ -3,6 +3,8 @@ using BitPantry.CommandLine.Client;\n using BitPantry.CommandLine.Component;\n using BitPantry.CommandLine.Processing.Parsing;\n using Microsoft.Extensions.DependencyInjection;\n+using Microsoft.Extensions.Logging;\n+using Microsoft.Extensions.Logging.Abstractions;\n using System;\n using System.Collections.Generic;\n using System.Linq;\n@@ -21,6 +23,7 @@ namespace BitPantry.CommandLine.AutoComplete\n         private readonly IServiceProvider _serviceProvider;\n         private readonly IAutoCompleteHandlerRegistry _handlerRegistry;\n         private readonly AutoCompleteHandlerActivator _activator;\n+        private readonly ILogger<AutoCompleteOptionSetBuilder> _logger;\n \n         /// <summary>\n         /// Initializes a new instance of the AutoCompleteOptionsBuilder\n@@ -29,17 +32,20 @@ namespace BitPantry.CommandLine.AutoComplete\n         /// <param name=\"serverProxy\">The server proxy to use for auto completion of argument values</param>\n         /// <param name=\"serviceProvider\">The service provider to use for instantiating command objects and handlers</param>\n         /// <param name=\"handlerRegistry\">The handler registry for autocomplete handlers</param>\n+        /// <param name=\"logger\">Optional logger for logging handler exceptions</param>\n         public AutoCompleteOptionSetBuilder(\n             ICommandRegistry registry, \n             IServerProxy serverProxy, \n             IServiceProvider serviceProvider,\n-            IAutoCompleteHandlerRegistry handlerRegistry)\n+            IAutoCompleteHandlerRegistry handlerRegistry,\n+            ILogger<AutoCompleteOptionSetBuilder> logger = null)\n         {\n             _registry = registry;\n             _serverProxy = serverProxy;\n             _serviceProvider = serviceProvider;\n             _handlerRegistry = handlerRegistry;\n             _activator = new AutoCompleteHandlerActivator(serviceProvider);\n+            _logger = logger ?? NullLogger<AutoCompleteOptionSetBuilder>.Instance;\n         }\n \n \n@@ -256,9 +262,16 @@ namespace BitPantry.CommandLine.AutoComplete\n \n             // Activate and invoke the handler (scope disposed after use)\n             using var activation = _activator.Activate(handlerType);\n-            var results = await activation.Handler.GetOptionsAsync(context, token);\n-\n-            return BuildAutoCompleteOptionSet(results, parsedElement.Value);\n+            try\n+            {\n+                var results = await activation.Handler.GetOptionsAsync(context, token);\n+                return BuildAutoCompleteOptionSet(results, parsedElement.Value);\n+            }\n+            catch (Exception ex)\n+            {\n+                _logger.LogError(ex, \"Handler {HandlerType} threw exception during autocomplete\", handlerType.Name);\n+                return null;\n+            }\n         }\n \n         /// <summary>\n@@ -556,10 +569,17 @@ namespace BitPantry.CommandLine.AutoComplete\n \n             // Activate and invoke the handler (scope disposed after use)\n             using var activation = _activator.Activate(handlerType);\n-            var results = await activation.Handler.GetOptionsAsync(context, token);\n-\n-            // build options from the results\n-            return BuildOptionSet(results, parsedElement.Value, true);\n+            try\n+            {\n+                var results = await activation.Handler.GetOptionsAsync(context, token);\n+                // build options from the results\n+                return BuildOptionSet(results, parsedElement.Value, true);\n+            }\n+            catch (Exception ex)\n+            {\n+                _logger.LogError(ex, \"Handler {HandlerType} threw exception during autocomplete\", handlerType.Name);\n+                return null;\n+            }\n         }\n \n         /// <summary>\ndiff --git a/specs/008-autocomplete-extensions/batch-state.json b/specs/008-autocomplete-extensions/batch-state.json\nindex 8c4e296..cc06478 100644\n--- a/specs/008-autocomplete-extensions/batch-state.json\n+++ b/specs/008-autocomplete-extensions/batch-state.json\n@@ -356,7 +356,7 @@\n       \"phase\": \"pending\"\n     },\n     \"T036a\": {\n-      \"phase\": \"started\",\n+      \"phase\": \"red\",\n       \"status\": \"in-progress\"\n     },\n     \"T018\": {\ndiff --git a/specs/008-autocomplete-extensions/evidence/T036a.json b/specs/008-autocomplete-extensions/evidence/T036a.json\nindex 607beab..74749ee 100644\n--- a/specs/008-autocomplete-extensions/evidence/T036a.json\n+++ b/specs/008-autocomplete-extensions/evidence/T036a.json\n@@ -1,4 +1,12 @@\n {\n   \"taskId\": \"T036a\",\n-  \"testCase\": \"\"\n+  \"testCase\": \"\",\n+  \"red\": {\n+    \"timestamp\": \"2026-01-21T17:08:11.8440763-06:00\",\n+    \"testCommand\": \"dotnet test --filter HandlerException_GracefullyDegrades_ReturnsNoSuggestions\",\n+    \"exitCode\": 1,\n+    \"output\": \"System.InvalidOperationException: Test exception from ThrowingHandler\",\n+    \"testFile\": \"BitPantry.CommandLine.Tests/AutoCompleteControllerTests.cs\",\n+    \"testMethod\": \"HandlerException_GracefullyDegrades_ReturnsNoSuggestions\"\n+  }\n }"
  }
}
