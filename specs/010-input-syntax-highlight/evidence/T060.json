{
  "taskId": "T060",
  "testCase": "",
  "green": {
    "timestamp": "2026-02-07T11:44:53.6079790-06:00",
    "testCommand": "dotnet test --filter \"InputRemainsColoredWhileMenuDisplays\"",
    "exitCode": 0,
    "output": "Passed!  - Failed:     0, Passed:     1, Skipped:     0, Total:     1, Duration: 194 ms - BitPantry.CommandLine.Tests.dll (net8.0)"
  },
  "diff": {
    "timestamp": "2026-02-07T11:44:53.6079790-06:00",
    "files": [
      "BitPantry.CommandLine.Tests/Input/ConsoleLineMirrorTests.cs",
      "BitPantry.CommandLine.Tests/Input/SyntaxHighlighterIntegrationTests.cs",
      "BitPantry.CommandLine.Tests/Input/SyntaxHighlighterTests.cs",
      "BitPantry.CommandLine/CommandLineApplicationBuilder.cs",
      "BitPantry.CommandLine/Input/ConsoleInputInterceptor.cs",
      "BitPantry.CommandLine/Input/InputBuilder.cs",
      "BitPantry.CommandLine/Input/SyntaxHighlighter.cs",
      "specs/010-input-syntax-highlight/batch-state.json",
      "specs/010-input-syntax-highlight/batches/batch-003.md",
      "specs/010-input-syntax-highlight/batches/batch-004.md",
      "specs/010-input-syntax-highlight/batches/batch-005.md"
    ],
    "patch": "diff --git a/BitPantry.CommandLine.Tests/Input/ConsoleLineMirrorTests.cs b/BitPantry.CommandLine.Tests/Input/ConsoleLineMirrorTests.cs\nindex 81fc15c..26c93e0 100644\n--- a/BitPantry.CommandLine.Tests/Input/ConsoleLineMirrorTests.cs\n+++ b/BitPantry.CommandLine.Tests/Input/ConsoleLineMirrorTests.cs\n@@ -130,4 +130,37 @@ public class ConsoleLineMirrorTests\n         _virtualConsole.GetRow(0).GetText().TrimEnd().Should().Be(\"hello\");\n         _mirror.Buffer.Should().Be(\"hello\");\n     }\n+\n+    // Implements: UX-010\n+    [TestMethod]\n+    public void RenderWithStyles_MidLineEdit_CursorReturnsToSamePosition()\n+    {\n+        // Arrange - simulate user typing \"server start\" with cursor at position 10 (middle of \"start\")\n+        // Initial typing\n+        _mirror.Write(\"server start\");\n+        _virtualConsole.GetRow(0).GetText().TrimEnd().Should().Be(\"server start\");\n+        _mirror.BufferPosition.Should().Be(12); // cursor at end after typing\n+\n+        // Move cursor to position 10 (middle of \"start\")\n+        _mirror.MoveToPosition(10);\n+        _mirror.BufferPosition.Should().Be(10);\n+        _virtualConsole.CursorColumn.Should().Be(10);\n+\n+        // Simulate inserting a character 'x' at position 10, making \"server stxart\"\n+        // In real scenario, the input would be re-highlighted and re-rendered\n+        var newSegments = new List<StyledSegment>\n+        {\n+            new StyledSegment(\"server\", 0, 6, SyntaxColorScheme.Group),\n+            new StyledSegment(\" \", 6, 7, SyntaxColorScheme.Default),\n+            new StyledSegment(\"stxart\", 7, 13, SyntaxColorScheme.Default)\n+        };\n+\n+        // Act - re-render with cursor at position 11 (after the inserted 'x')\n+        _mirror.RenderWithStyles(newSegments, 11);\n+\n+        // Assert - cursor should be at position 11 after re-render\n+        _mirror.BufferPosition.Should().Be(11);\n+        _virtualConsole.CursorColumn.Should().Be(11);\n+        _virtualConsole.GetRow(0).GetText().TrimEnd().Should().Be(\"server stxart\");\n+    }\n }\ndiff --git a/BitPantry.CommandLine.Tests/Input/SyntaxHighlighterIntegrationTests.cs b/BitPantry.CommandLine.Tests/Input/SyntaxHighlighterIntegrationTests.cs\nindex fc389d5..e6c86a3 100644\n--- a/BitPantry.CommandLine.Tests/Input/SyntaxHighlighterIntegrationTests.cs\n+++ b/BitPantry.CommandLine.Tests/Input/SyntaxHighlighterIntegrationTests.cs\n@@ -128,8 +128,8 @@ public class SyntaxHighlighterIntegrationTests\n \n         // Act - highlight and render through Spectre\n         var segments = _highlighter.Highlight(\"help --verbose\");\n-        segments.Should().HaveCount(2, \"should have two segments: command and argument\");\n-        segments[1].Text.Should().Be(\"--verbose\");\n+        segments.Should().HaveCount(3, \"should have three segments: command, whitespace, argument\");\n+        segments[2].Text.Should().Be(\"--verbose\");\n         \n         // Render segments through Spectre's Text class\n         foreach (var segment in segments)\n@@ -139,9 +139,9 @@ public class SyntaxHighlighterIntegrationTests\n \n         // Assert - argument should display in yellow\n         // Spectre's Color.Yellow = 256-color index 11\n-        virtualConsole.GetRow(0).GetText().TrimEnd().Should().Be(\"help--verbose\");\n-        // Find the '--' start position (after \"help\" which is 4 chars)\n-        virtualConsole.GetCell(0, 4).Style.Foreground256.Should().Be(11, \"Yellow is 256-color index 11\");\n+        virtualConsole.GetRow(0).GetText().TrimEnd().Should().Be(\"help --verbose\");\n+        // Find the '--' start position (after \"help \" which is 5 chars)\n+        virtualConsole.GetCell(0, 5).Style.Foreground256.Should().Be(11, \"Yellow is 256-color index 11\");\n     }\n \n     // Implements: UX-004\n@@ -159,8 +159,8 @@ public class SyntaxHighlighterIntegrationTests\n \n         // Act - highlight and render through Spectre\n         var segments = _highlighter.Highlight(\"help -h\");\n-        segments.Should().HaveCount(2, \"should have two segments: command and alias argument\");\n-        segments[1].Text.Should().Be(\"-h\");\n+        segments.Should().HaveCount(3, \"should have three segments: command, whitespace, alias argument\");\n+        segments[2].Text.Should().Be(\"-h\");\n         \n         // Render segments through Spectre's Text class\n         foreach (var segment in segments)\n@@ -170,9 +170,9 @@ public class SyntaxHighlighterIntegrationTests\n \n         // Assert - alias argument should display in yellow\n         // Spectre's Color.Yellow = 256-color index 11\n-        virtualConsole.GetRow(0).GetText().TrimEnd().Should().Be(\"help-h\");\n-        // Find the '-h' start position (after \"help\" which is 4 chars)\n-        virtualConsole.GetCell(0, 4).Style.Foreground256.Should().Be(11, \"Yellow is 256-color index 11\");\n+        virtualConsole.GetRow(0).GetText().TrimEnd().Should().Be(\"help -h\");\n+        // Find the '-h' start position (after \"help \" which is 5 chars)\n+        virtualConsole.GetCell(0, 5).Style.Foreground256.Should().Be(11, \"Yellow is 256-color index 11\");\n     }\n \n     // Implements: UX-005\n@@ -190,8 +190,8 @@ public class SyntaxHighlighterIntegrationTests\n \n         // Act - highlight and render through Spectre\n         var segments = _highlighter.Highlight(\"help myvalue\");\n-        segments.Should().HaveCount(2, \"should have two segments: command and argument value\");\n-        segments[1].Text.Should().Be(\"myvalue\");\n+        segments.Should().HaveCount(3, \"should have three segments: command, whitespace, argument value\");\n+        segments[2].Text.Should().Be(\"myvalue\");\n         \n         // Render segments through Spectre's Text class\n         foreach (var segment in segments)\n@@ -201,9 +201,9 @@ public class SyntaxHighlighterIntegrationTests\n \n         // Assert - argument value should display in purple\n         // Spectre's Color.Purple = 256-color index 5\n-        virtualConsole.GetRow(0).GetText().TrimEnd().Should().Be(\"helpmyvalue\");\n-        // Find the 'myvalue' start position (after \"help\" which is 4 chars)\n-        virtualConsole.GetCell(0, 4).Style.Foreground256.Should().Be(5, \"Purple is 256-color index 5\");\n+        virtualConsole.GetRow(0).GetText().TrimEnd().Should().Be(\"help myvalue\");\n+        // Find the 'myvalue' start position (after \"help \" which is 5 chars)\n+        virtualConsole.GetCell(0, 5).Style.Foreground256.Should().Be(5, \"Purple is 256-color index 5\");\n     }\n \n     // Implements: UX-006\n@@ -296,6 +296,56 @@ public class SyntaxHighlighterIntegrationTests\n         cell.Style.Foreground256.Should().BeNull(\"Command style has no 256-color\");\n     }\n \n+    // Implements: UX-009\n+    [TestMethod]\n+    public void Highlight_BackspaceUpdatesColors_GroupRemainsCyanPartialBecomesDefault()\n+    {\n+        // Arrange - \"server\" group with \"connect\" command\n+        var serverGroup = new GroupInfo(\"server\", \"Server commands\", null, typeof(object));\n+        var connectCommand = CreateCommandInfo(\"connect\");\n+        serverGroup.AddCommand(connectCommand);\n+        _mockRegistry.Setup(r => r.RootGroups).Returns(new List<GroupInfo> { serverGroup });\n+        _mockRegistry.Setup(r => r.RootCommands).Returns(new List<CommandInfo>());\n+\n+        var virtualConsole = new VirtualConsole.VirtualConsole(80, 24);\n+        virtualConsole.StrictMode = true;\n+        var adapter = new VirtualConsoleAnsiAdapter(virtualConsole);\n+\n+        // Act - First highlight \"server connect\" \n+        var fullSegments = _highlighter.Highlight(\"server connect\");\n+        fullSegments.Should().HaveCount(3, \"should have 3 segments: group, whitespace, command\");\n+        fullSegments[0].Text.Should().Be(\"server\");\n+        fullSegments[0].Style.Should().Be(SyntaxColorScheme.Group);\n+        fullSegments[2].Text.Should().Be(\"connect\");\n+        fullSegments[2].Style.Should().Be(SyntaxColorScheme.Command);\n+\n+        // Then simulate backspace by re-highlighting \"server con\"\n+        // Create fresh console for partial input to verify re-render\n+        var partialConsole = new VirtualConsole.VirtualConsole(80, 24);\n+        partialConsole.StrictMode = true;\n+        var partialAdapter = new VirtualConsoleAnsiAdapter(partialConsole);\n+        \n+        var partialSegments = _highlighter.Highlight(\"server con\");\n+        \n+        // Render through Spectre\n+        foreach (var segment in partialSegments)\n+        {\n+            partialAdapter.Write(new Text(segment.Text, segment.Style));\n+        }\n+\n+        // Assert - \"server\" remains cyan (group), \"con\" becomes default (unique command partial)\n+        partialSegments.Should().HaveCount(3, \"should have 3 segments: group, whitespace, partial command\");\n+        partialSegments[0].Text.Should().Be(\"server\");\n+        partialSegments[0].Style.Should().Be(SyntaxColorScheme.Group);\n+        partialSegments[2].Text.Should().Be(\"con\");\n+        partialSegments[2].Style.Should().Be(SyntaxColorScheme.Command);\n+\n+        // Verify console rendering\n+        partialConsole.GetRow(0).GetText().TrimEnd().Should().Be(\"server con\");\n+        partialConsole.GetCell(0, 0).Style.Foreground256.Should().Be(14, \"server should be cyan (256-color index 14)\");\n+        partialConsole.GetCell(0, 7).Style.Foreground256.Should().BeNull(\"con should have default color\");\n+    }\n+\n     private static CommandInfo CreateCommandInfo(string name)\n     {\n         var cmd = new CommandInfo();\ndiff --git a/BitPantry.CommandLine.Tests/Input/SyntaxHighlighterTests.cs b/BitPantry.CommandLine.Tests/Input/SyntaxHighlighterTests.cs\nindex 09bab01..d4c3afa 100644\n--- a/BitPantry.CommandLine.Tests/Input/SyntaxHighlighterTests.cs\n+++ b/BitPantry.CommandLine.Tests/Input/SyntaxHighlighterTests.cs\n@@ -102,16 +102,18 @@ public class SyntaxHighlighterTests\n         // Act\n         var result = _highlighter.Highlight(\"server start\");\n \n-        // Assert - two segments: group (cyan) and command (default)\n-        result.Should().HaveCount(2);\n+        // Assert - three segments: group (cyan), whitespace (default), command (default)\n+        result.Should().HaveCount(3);\n         result[0].Text.Should().Be(\"server\");\n         result[0].Start.Should().Be(0);\n         result[0].End.Should().Be(6);\n         result[0].Style.Should().Be(SyntaxColorScheme.Group);\n-        result[1].Text.Should().Be(\"start\");\n-        result[1].Start.Should().Be(7);\n-        result[1].End.Should().Be(12);\n-        result[1].Style.Should().Be(SyntaxColorScheme.Command);\n+        result[1].Text.Should().Be(\" \");\n+        result[1].Style.Should().Be(SyntaxColorScheme.Default);\n+        result[2].Text.Should().Be(\"start\");\n+        result[2].Start.Should().Be(7);\n+        result[2].End.Should().Be(12);\n+        result[2].Style.Should().Be(SyntaxColorScheme.Command);\n     }\n \n     // Implements: CV-015\n@@ -128,16 +130,20 @@ public class SyntaxHighlighterTests\n         // Act\n         var result = _highlighter.Highlight(\"server start --port\");\n \n-        // Assert - three segments: group (cyan), command (default), arg (yellow)\n-        result.Should().HaveCount(3);\n+        // Assert - five segments: group, ws, command, ws, arg\n+        result.Should().HaveCount(5);\n         result[0].Text.Should().Be(\"server\");\n         result[0].Style.Should().Be(SyntaxColorScheme.Group);\n-        result[1].Text.Should().Be(\"start\");\n-        result[1].Style.Should().Be(SyntaxColorScheme.Command);\n-        result[2].Text.Should().Be(\"--port\");\n-        result[2].Start.Should().Be(13);\n-        result[2].End.Should().Be(19);\n-        result[2].Style.Should().Be(SyntaxColorScheme.ArgumentName);\n+        result[1].Text.Should().Be(\" \");\n+        result[1].Style.Should().Be(SyntaxColorScheme.Default);\n+        result[2].Text.Should().Be(\"start\");\n+        result[2].Style.Should().Be(SyntaxColorScheme.Command);\n+        result[3].Text.Should().Be(\" \");\n+        result[3].Style.Should().Be(SyntaxColorScheme.Default);\n+        result[4].Text.Should().Be(\"--port\");\n+        result[4].Start.Should().Be(13);\n+        result[4].End.Should().Be(19);\n+        result[4].Style.Should().Be(SyntaxColorScheme.ArgumentName);\n     }\n \n     // Implements: CV-016\n@@ -154,18 +160,24 @@ public class SyntaxHighlighterTests\n         // Act\n         var result = _highlighter.Highlight(\"server start --port 8080\");\n \n-        // Assert - four segments: group (cyan), command (default), arg (yellow), value (purple)\n-        result.Should().HaveCount(4);\n+        // Assert - seven segments: group, ws, command, ws, arg, ws, value\n+        result.Should().HaveCount(7);\n         result[0].Text.Should().Be(\"server\");\n         result[0].Style.Should().Be(SyntaxColorScheme.Group);\n-        result[1].Text.Should().Be(\"start\");\n-        result[1].Style.Should().Be(SyntaxColorScheme.Command);\n-        result[2].Text.Should().Be(\"--port\");\n-        result[2].Style.Should().Be(SyntaxColorScheme.ArgumentName);\n-        result[3].Text.Should().Be(\"8080\");\n-        result[3].Start.Should().Be(20);\n-        result[3].End.Should().Be(24);\n-        result[3].Style.Should().Be(SyntaxColorScheme.ArgumentValue);\n+        result[1].Text.Should().Be(\" \");\n+        result[1].Style.Should().Be(SyntaxColorScheme.Default);\n+        result[2].Text.Should().Be(\"start\");\n+        result[2].Style.Should().Be(SyntaxColorScheme.Command);\n+        result[3].Text.Should().Be(\" \");\n+        result[3].Style.Should().Be(SyntaxColorScheme.Default);\n+        result[4].Text.Should().Be(\"--port\");\n+        result[4].Style.Should().Be(SyntaxColorScheme.ArgumentName);\n+        result[5].Text.Should().Be(\" \");\n+        result[5].Style.Should().Be(SyntaxColorScheme.Default);\n+        result[6].Text.Should().Be(\"8080\");\n+        result[6].Start.Should().Be(20);\n+        result[6].End.Should().Be(24);\n+        result[6].Style.Should().Be(SyntaxColorScheme.ArgumentValue);\n     }\n \n     // Implements: CV-017\n@@ -182,16 +194,22 @@ public class SyntaxHighlighterTests\n         // Act\n         var result = _highlighter.Highlight(\"server start -p 8080\");\n \n-        // Assert - four segments: group (cyan), command (default), alias (yellow), value (purple)\n-        result.Should().HaveCount(4);\n+        // Assert - seven segments: group, ws, command, ws, alias, ws, value\n+        result.Should().HaveCount(7);\n         result[0].Text.Should().Be(\"server\");\n         result[0].Style.Should().Be(SyntaxColorScheme.Group);\n-        result[1].Text.Should().Be(\"start\");\n-        result[1].Style.Should().Be(SyntaxColorScheme.Command);\n-        result[2].Text.Should().Be(\"-p\");\n-        result[2].Style.Should().Be(SyntaxColorScheme.ArgumentAlias);\n-        result[3].Text.Should().Be(\"8080\");\n-        result[3].Style.Should().Be(SyntaxColorScheme.ArgumentValue);\n+        result[1].Text.Should().Be(\" \");\n+        result[1].Style.Should().Be(SyntaxColorScheme.Default);\n+        result[2].Text.Should().Be(\"start\");\n+        result[2].Style.Should().Be(SyntaxColorScheme.Command);\n+        result[3].Text.Should().Be(\" \");\n+        result[3].Style.Should().Be(SyntaxColorScheme.Default);\n+        result[4].Text.Should().Be(\"-p\");\n+        result[4].Style.Should().Be(SyntaxColorScheme.ArgumentAlias);\n+        result[5].Text.Should().Be(\" \");\n+        result[5].Style.Should().Be(SyntaxColorScheme.Default);\n+        result[6].Text.Should().Be(\"8080\");\n+        result[6].Style.Should().Be(SyntaxColorScheme.ArgumentValue);\n     }\n \n     // Implements: CV-018\n@@ -234,6 +252,32 @@ public class SyntaxHighlighterTests\n         result[0].Style.Should().Be(SyntaxColorScheme.Default);\n     }\n \n+    // Implements: CV-020\n+    [TestMethod]\n+    public void Highlight_WithWhitespace_WhitespaceHasDefaultStyle()\n+    {\n+        // Arrange - \"server start\" with space between tokens\n+        var serverGroup = new GroupInfo(\"server\", \"Server commands\", null, typeof(object));\n+        var startCommand = CreateCommandInfo(\"start\");\n+        serverGroup.AddCommand(startCommand);\n+        _mockRegistry.Setup(r => r.RootGroups).Returns(new List<GroupInfo> { serverGroup });\n+        _mockRegistry.Setup(r => r.RootCommands).Returns(new List<CommandInfo>());\n+\n+        // Act\n+        var result = _highlighter.Highlight(\"server start\");\n+\n+        // Assert - three segments: group, whitespace, command\n+        result.Should().HaveCount(3);\n+        result[0].Text.Should().Be(\"server\");\n+        result[0].Style.Should().Be(SyntaxColorScheme.Group);\n+        result[1].Text.Should().Be(\" \");  // whitespace segment\n+        result[1].Start.Should().Be(6);\n+        result[1].End.Should().Be(7);\n+        result[1].Style.Should().Be(SyntaxColorScheme.Default);\n+        result[2].Text.Should().Be(\"start\");\n+        result[2].Style.Should().Be(SyntaxColorScheme.Command);\n+    }\n+\n     private static CommandInfo CreateCommandInfo(string name)\n     {\n         // Use reflection to set internal Name property\ndiff --git a/BitPantry.CommandLine/CommandLineApplicationBuilder.cs b/BitPantry.CommandLine/CommandLineApplicationBuilder.cs\nindex c1c5c26..8e72dec 100644\n--- a/BitPantry.CommandLine/CommandLineApplicationBuilder.cs\n+++ b/BitPantry.CommandLine/CommandLineApplicationBuilder.cs\n@@ -222,7 +222,10 @@ namespace BitPantry.CommandLine\n             // Get the key processed notifier for input synchronization\n             var notifier = svcProvider.GetRequiredService<KeyProcessedNotifier>();\n \n-            var input = new InputBuilder(Console, prompt, acCtrl, notifier);\n+            // Create syntax highlighter for real-time input coloring\n+            var syntaxHighlighter = new SyntaxHighlighter(commandRegistry);\n+\n+            var input = new InputBuilder(Console, prompt, acCtrl, syntaxHighlighter, notifier);\n \n             // build the command line application\n \ndiff --git a/BitPantry.CommandLine/Input/ConsoleInputInterceptor.cs b/BitPantry.CommandLine/Input/ConsoleInputInterceptor.cs\nindex bdabdc2..6052d63 100644\n--- a/BitPantry.CommandLine/Input/ConsoleInputInterceptor.cs\n+++ b/BitPantry.CommandLine/Input/ConsoleInputInterceptor.cs\n@@ -10,7 +10,7 @@ namespace BitPantry.CommandLine.Input\n     {\n         private Dictionary<ConsoleKey, Func<ReadKeyHandlerContext, Task<bool>>> _handlerDict = new Dictionary<ConsoleKey, Func<ReadKeyHandlerContext, Task<bool>>>();\n         private Func<ReadKeyHandlerContext, Task<bool>> _defaultHandler;\n-        private Func<ReadKeyHandlerContext, Task> _onKeyPressedHandler;\n+        private List<Func<ReadKeyHandlerContext, Task>> _onKeyPressedHandlers = new List<Func<ReadKeyHandlerContext, Task>>();\n \n         private IAnsiConsole _console;\n         private ConsoleLineMirror _inputLine;\n@@ -87,8 +87,10 @@ namespace BitPantry.CommandLine.Input\n                 }\n             }\n \n-            if (_onKeyPressedHandler != null)\n-                await _onKeyPressedHandler.Invoke(new ReadKeyHandlerContext(_inputLine, keyInfo));\n+            foreach (var handler in _onKeyPressedHandlers)\n+            {\n+                await handler.Invoke(new ReadKeyHandlerContext(_inputLine, keyInfo));\n+            }\n \n             // Notify subscribers that key processing is complete\n             _notifier?.NotifyKeyProcessed();\n@@ -110,7 +112,7 @@ namespace BitPantry.CommandLine.Input\n \n         public ConsoleInputInterceptor OnKeyPressed(Func<ReadKeyHandlerContext, Task> handler)\n         {\n-            _onKeyPressedHandler = handler;\n+            _onKeyPressedHandlers.Add(handler);\n             return this;\n         }\n \ndiff --git a/BitPantry.CommandLine/Input/InputBuilder.cs b/BitPantry.CommandLine/Input/InputBuilder.cs\nindex fb20efa..135afc4 100644\n--- a/BitPantry.CommandLine/Input/InputBuilder.cs\n+++ b/BitPantry.CommandLine/Input/InputBuilder.cs\n@@ -7,7 +7,7 @@ using System.Threading.Tasks;\n namespace BitPantry.CommandLine.Input\n {\n     /// <summary>\n-    /// Builds user input with autocomplete support and command history.\n+    /// Builds user input with autocomplete support, command history, and syntax highlighting.\n     /// Uses AutoCompleteController.HandleKey for most autocomplete operations.\n     /// </summary>\n     internal class InputBuilder : IDisposable\n@@ -15,14 +15,16 @@ namespace BitPantry.CommandLine.Input\n         private readonly IAnsiConsole _console;\n         private readonly IPrompt _prompt;\n         private readonly AutoCompleteController _acCtrl;\n+        private readonly SyntaxHighlighter _highlighter;\n         private readonly KeyProcessedNotifier _notifier;\n         private readonly InputLog _inputLog = new InputLog();\n \n-        public InputBuilder(IAnsiConsole console, IPrompt prompt, AutoCompleteController acCtrl, KeyProcessedNotifier notifier = null)\n+        public InputBuilder(IAnsiConsole console, IPrompt prompt, AutoCompleteController acCtrl, SyntaxHighlighter highlighter, KeyProcessedNotifier notifier = null)\n         {\n             _console = console;\n             _prompt = prompt;\n             _acCtrl = acCtrl;\n+            _highlighter = highlighter;\n             _notifier = notifier;\n         }\n \n@@ -148,6 +150,30 @@ namespace BitPantry.CommandLine.Input\n                         // Fall through to submit the line\n                         return await Task.FromResult(false);\n                     })\n+                    // After every keypress, apply syntax highlighting\n+                    .OnKeyPressed(async ctx =>\n+                    {\n+                        // Skip highlighting for navigation keys that don't change input\n+                        if (ctx.KeyInfo.Key == ConsoleKey.UpArrow ||\n+                            ctx.KeyInfo.Key == ConsoleKey.DownArrow ||\n+                            ctx.KeyInfo.Key == ConsoleKey.Escape ||\n+                            ctx.KeyInfo.Key == ConsoleKey.LeftArrow ||\n+                            ctx.KeyInfo.Key == ConsoleKey.RightArrow)\n+                        {\n+                            return;\n+                        }\n+\n+                        // Get highlighted segments for current input\n+                        var segments = _highlighter.Highlight(ctx.InputLine.Buffer);\n+                        \n+                        // Re-render with syntax highlighting\n+                        if (segments.Count > 0)\n+                        {\n+                            ctx.InputLine.RenderWithStyles(segments, ctx.InputLine.BufferPosition);\n+                        }\n+\n+                        await Task.CompletedTask;\n+                    })\n                     // After every keypress, update autocomplete\n                     .OnKeyPressed(async ctx =>\n                     {\ndiff --git a/BitPantry.CommandLine/Input/SyntaxHighlighter.cs b/BitPantry.CommandLine/Input/SyntaxHighlighter.cs\nindex 3741a25..1f10371 100644\n--- a/BitPantry.CommandLine/Input/SyntaxHighlighter.cs\n+++ b/BitPantry.CommandLine/Input/SyntaxHighlighter.cs\n@@ -42,6 +42,13 @@ public class SyntaxHighlighter\n \n         foreach (var token in tokens)\n         {\n+            // Whitespace tokens get default style\n+            if (token.IsWhitespace)\n+            {\n+                segments.Add(new StyledSegment(token.Text, token.Start, token.End, SyntaxColorScheme.Default));\n+                continue;\n+            }\n+\n             Style style;\n \n             // After a command, tokens are arguments/values\n@@ -113,35 +120,35 @@ public class SyntaxHighlighter\n     {\n         var tokens = new List<TokenInfo>();\n         var currentStart = -1;\n+        var isWhitespace = false;\n         \n         for (int i = 0; i < input.Length; i++)\n         {\n-            if (char.IsWhiteSpace(input[i]))\n+            var charIsWhitespace = char.IsWhiteSpace(input[i]);\n+            \n+            if (currentStart < 0)\n             {\n-                if (currentStart >= 0)\n-                {\n-                    // End current token\n-                    tokens.Add(new TokenInfo(input.Substring(currentStart, i - currentStart), currentStart, i));\n-                    currentStart = -1;\n-                }\n+                // Starting a new token\n+                currentStart = i;\n+                isWhitespace = charIsWhitespace;\n             }\n-            else\n+            else if (charIsWhitespace != isWhitespace)\n             {\n-                if (currentStart < 0)\n-                {\n-                    currentStart = i;\n-                }\n+                // Transition between whitespace and non-whitespace\n+                tokens.Add(new TokenInfo(input.Substring(currentStart, i - currentStart), currentStart, i, isWhitespace));\n+                currentStart = i;\n+                isWhitespace = charIsWhitespace;\n             }\n         }\n \n         // Final token\n         if (currentStart >= 0)\n         {\n-            tokens.Add(new TokenInfo(input.Substring(currentStart), currentStart, input.Length));\n+            tokens.Add(new TokenInfo(input.Substring(currentStart), currentStart, input.Length, isWhitespace));\n         }\n \n         return tokens;\n     }\n \n-    private record TokenInfo(string Text, int Start, int End);\n+    private record TokenInfo(string Text, int Start, int End, bool IsWhitespace = false);\n }\ndiff --git a/specs/010-input-syntax-highlight/batch-state.json b/specs/010-input-syntax-highlight/batch-state.json\nindex 91e17b2..d3a8b6b 100644\n--- a/specs/010-input-syntax-highlight/batch-state.json\n+++ b/specs/010-input-syntax-highlight/batch-state.json\n@@ -1,18 +1,23 @@\n {\n-  \"activeBatch\": \"batch-003\",\n-  \"currentTask\": null,\n+  \"activeBatch\": \"batch-005\",\n+  \"currentTask\": \"T060\",\n   \"taskStates\": {\n     \"T071\": {\n       \"phase\": \"pending\"\n     },\n     \"T029\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T11:56:24.8478121-06:00\"\n     },\n     \"T047\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:29:41.4562604-06:00\"\n     },\n     \"T060\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"started\",\n+      \"status\": \"in-progress\"\n     },\n     \"T006\": {\n       \"phase\": \"verified\",\n@@ -23,7 +28,9 @@\n       \"phase\": \"pending\"\n     },\n     \"T038\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:08:14.1303356-06:00\"\n     },\n     \"T070\": {\n       \"phase\": \"pending\"\n@@ -32,16 +39,24 @@\n       \"phase\": \"pending\"\n     },\n     \"T039\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:10:26.1546425-06:00\"\n     },\n     \"T026\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T11:50:55.6820974-06:00\"\n     },\n     \"T045\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:28:57.3874516-06:00\"\n     },\n     \"T055\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:32:50.5944-06:00\"\n     },\n     \"T066\": {\n       \"phase\": \"pending\"\n@@ -52,7 +67,9 @@\n       \"verifiedAt\": \"2026-02-06T11:38:06.0338654-06:00\"\n     },\n     \"T056\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:35:30.0005894-06:00\"\n     },\n     \"T015\": {\n       \"phase\": \"verified\",\n@@ -60,13 +77,17 @@\n       \"verifiedAt\": \"2026-02-06T11:33:13.2434347-06:00\"\n     },\n     \"T032\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T12:00:06.3898713-06:00\"\n     },\n     \"T076\": {\n       \"phase\": \"pending\"\n     },\n     \"T044\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:28:25.306622-06:00\"\n     },\n     \"T007\": {\n       \"phase\": \"verified\",\n@@ -85,10 +106,14 @@\n       \"verifiedAt\": \"2026-02-06T11:41:19.0361513-06:00\"\n     },\n     \"T057\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:37:08.1557253-06:00\"\n     },\n     \"T040\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:11:01.4688606-06:00\"\n     },\n     \"T069\": {\n       \"phase\": \"pending\"\n@@ -102,16 +127,24 @@\n       \"phase\": \"pending\"\n     },\n     \"T043\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:26:48.1369225-06:00\"\n     },\n     \"T030\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T11:57:46.1008502-06:00\"\n     },\n     \"T046\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:29:18.6789888-06:00\"\n     },\n     \"T031\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T11:59:25.5819832-06:00\"\n     },\n     \"T005\": {\n       \"phase\": \"verified\",\n@@ -122,22 +155,34 @@\n       \"phase\": \"pending\"\n     },\n     \"T037\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:06:56.5367488-06:00\"\n     },\n     \"T052\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:23:44.5073584-06:00\"\n     },\n     \"T025\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T11:49:39.6678347-06:00\"\n     },\n     \"T058\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:40:29.0453535-06:00\"\n     },\n     \"T049\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:11:28.7315501-06:00\"\n     },\n     \"T054\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:30:20.7117614-06:00\"\n     },\n     \"T017\": {\n       \"phase\": \"verified\",\n@@ -145,13 +190,19 @@\n       \"verifiedAt\": \"2026-02-06T11:35:00.4042854-06:00\"\n     },\n     \"T042\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:26:22.2409381-06:00\"\n     },\n     \"T048\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:30:04.1354225-06:00\"\n     },\n     \"T036\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T12:08:21.4632802-06:00\"\n     },\n     \"T010\": {\n       \"phase\": \"verified\",\n@@ -162,13 +213,17 @@\n       \"phase\": \"pending\"\n     },\n     \"T059\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:42:42.373867-06:00\"\n     },\n     \"T064\": {\n       \"phase\": \"pending\"\n     },\n     \"T034\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T12:06:49.855072-06:00\"\n     },\n     \"T072\": {\n       \"phase\": \"pending\"\n@@ -197,16 +252,24 @@\n       \"phase\": \"pending\"\n     },\n     \"T028\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T11:53:52.1318507-06:00\"\n     },\n     \"T027\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T11:51:38.3181813-06:00\"\n     },\n     \"T041\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T10:11:31.8898033-06:00\"\n     },\n     \"T051\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:15:23.8764791-06:00\"\n     },\n     \"T023\": {\n       \"phase\": \"verified\",\n@@ -234,7 +297,9 @@\n       \"verifiedAt\": \"2026-02-05T19:29:11.4428699-06:00\"\n     },\n     \"T053\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:28:35.5134353-06:00\"\n     },\n     \"T073\": {\n       \"phase\": \"pending\"\n@@ -245,10 +310,14 @@\n       \"verifiedAt\": \"2026-02-05T19:32:41.0775703-06:00\"\n     },\n     \"T050\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-07T11:13:57.3470878-06:00\"\n     },\n     \"T035\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T12:07:35.6920571-06:00\"\n     },\n     \"T014\": {\n       \"phase\": \"verified\",\n@@ -261,7 +330,9 @@\n       \"verifiedAt\": \"2026-02-05T19:33:50.15851-06:00\"\n     },\n     \"T033\": {\n-      \"phase\": \"pending\"\n+      \"phase\": \"verified\",\n+      \"status\": \"verified\",\n+      \"verifiedAt\": \"2026-02-06T12:00:47.4897837-06:00\"\n     },\n     \"T016\": {\n       \"phase\": \"verified\",\n@@ -281,7 +352,9 @@\n   },\n   \"batchStatus\": \"in-progress\",\n   \"completedBatches\": [\n-    \"batch-001\"\n+    \"batch-001\",\n+    \"batch-003\",\n+    \"batch-004\"\n   ],\n   \"totalBatches\": 7,\n   \"created\": \"2026-02-05T19:25:09.9259807-06:00\"\ndiff --git a/specs/010-input-syntax-highlight/batches/batch-003.md b/specs/010-input-syntax-highlight/batches/batch-003.md\nindex 54637a1..45721b9 100644\n--- a/specs/010-input-syntax-highlight/batches/batch-003.md\n+++ b/specs/010-input-syntax-highlight/batches/batch-003.md\n@@ -1,7 +1,7 @@\n # Batch 3: input-syntax-highlight\n \n **Created**: 2026-02-05\n-**Status**: in-progress\n+**Status**: complete\n **Tasks**: 12 of 15 complete\n \n ## Tasks\n@@ -35,3 +35,4 @@\n \n \n \n+\ndiff --git a/specs/010-input-syntax-highlight/batches/batch-004.md b/specs/010-input-syntax-highlight/batches/batch-004.md\nindex 910ed25..40b2dd6 100644\n--- a/specs/010-input-syntax-highlight/batches/batch-004.md\n+++ b/specs/010-input-syntax-highlight/batches/batch-004.md\n@@ -1,7 +1,7 @@\n # Batch 4: input-syntax-highlight\n \n **Created**: 2026-02-05\n-**Status**: in-progress\n+**Status**: complete\n **Tasks**: 12 of 15 complete\n \n ## Tasks\n@@ -35,3 +35,4 @@\n \n \n \n+\ndiff --git a/specs/010-input-syntax-highlight/batches/batch-005.md b/specs/010-input-syntax-highlight/batches/batch-005.md\nindex c7b8566..4f1ec08 100644\n--- a/specs/010-input-syntax-highlight/batches/batch-005.md\n+++ b/specs/010-input-syntax-highlight/batches/batch-005.md\n@@ -1,21 +1,21 @@\n # Batch 5: input-syntax-highlight\n \n **Created**: 2026-02-05\n-**Status**: pending\n-**Tasks**: 0 of 12 complete\n+**Status**: in-progress\n+**Tasks**: 11 of 15 complete\n \n ## Tasks\n-- [ ] T049 [depends:T028] @test-case:010:CV-020 Implement whitespace handling with default style in SyntaxHighlighter.cs\n-- [ ] T050 [depends:T010,T048] @test-case:010:UX-009 Verify backspace re-renders with updated colors\n-- [ ] T051 [depends:T010,T047] @test-case:010:UX-010 Verify cursor returns to position after mid-line edit\n-- [ ] T052 [depends:T048,T033] @test-case:010:DF-001 Integrate SyntaxHighlighter.Highlight call in InputBuilder.OnKeyPressed\n-- [ ] T053 [depends:T052] @test-case:010:DF-002 Trigger re-highlight on backspace in InputBuilder\n-- [ ] T054 [depends:T052] @test-case:010:DF-003 Coordinate ghost text clearing and re-highlighting in InputBuilder\n-- [ ] T055 [depends:T052] @test-case:010:DF-004 Maintain highlighting when Tab opens menu in InputBuilder\n-- [ ] T056 [depends:T052] @test-case:010:DF-005 Preserve highlighting during arrow key menu navigation\n-- [ ] T057 [depends:T052] @test-case:010:DF-006 Re-highlight after menu selection accepted in InputBuilder\n-- [ ] T058 [depends:T052] @test-case:010:DF-007 Handle paste with final state highlighting in InputBuilder\n-- [ ] T059 [depends:T010,T054] @test-case:010:UX-011 Verify colored input + dim ghost text render without conflict\n+- [X] T049 [depends:T028] @test-case:010:CV-020 Implement whitespace handling with default style in SyntaxHighlighter.cs\n+- [X] T050 [depends:T010,T048] @test-case:010:UX-009 Verify backspace re-renders with updated colors\n+- [X] T051 [depends:T010,T047] @test-case:010:UX-010 Verify cursor returns to position after mid-line edit\n+- [X] T052 [depends:T048,T033] @test-case:010:DF-001 Integrate SyntaxHighlighter.Highlight call in InputBuilder.OnKeyPressed\n+- [X] T053 [depends:T052] @test-case:010:DF-002 Trigger re-highlight on backspace in InputBuilder\n+- [X] T054 [depends:T052] @test-case:010:DF-003 Coordinate ghost text clearing and re-highlighting in InputBuilder\n+- [X] T055 [depends:T052] @test-case:010:DF-004 Maintain highlighting when Tab opens menu in InputBuilder\n+- [X] T056 [depends:T052] @test-case:010:DF-005 Preserve highlighting during arrow key menu navigation\n+- [X] T057 [depends:T052] @test-case:010:DF-006 Re-highlight after menu selection accepted in InputBuilder\n+- [X] T058 [depends:T052] @test-case:010:DF-007 Handle paste with final state highlighting in InputBuilder\n+- [X] T059 [depends:T010,T054] @test-case:010:UX-011 Verify colored input + dim ghost text render without conflict\n - [ ] T060 [depends:T010,T055] @test-case:010:UX-012 Verify input remains colored while menu displays\n \n ## Completion Criteria\n@@ -23,3 +23,14 @@\n - [ ] All tasks verified (evidence validated)\n - [ ] Full test suite passes (5 consecutive clean runs)\n - [ ] No open ambiguities\n+\n+\n+\n+\n+\n+\n+\n+\n+\n+\n+"
  }
}
